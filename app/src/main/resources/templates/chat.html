<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChatRoom - Real Time Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.1/stomp.min.js"></script>
    <style>
        body {
                    background: linear-gradient(135deg, #0f0f1f 0%, #1a1a2e 50%, #2d1b3a 100%);
                    min-height: 100vh;
                    color: #e0e0ff;
                    font-family: 'Segoe UI', sans-serif;
                }

                .chat-container {
                    max-width: 820px;
                    margin: 2rem auto;
                    border-radius: 20px;
                    overflow: hidden;
                    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
                    background: rgba(20, 20, 40, 0.65);
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(100, 80, 150, 0.2);
                }

                .chat-header {
                    background: linear-gradient(135deg, #2a1b3d, #443a6e);
                    color: #e0d4ff;
                    padding: 1.8rem;
                    text-align: center;
                    border-bottom: 1px solid rgba(100, 80, 150, 0.3);
                }

                .chat-messages {
                    height: 65vh;
                    overflow-y: auto;
                    padding: 1.5rem;
                    background: rgba(15, 15, 31, 0.7);
                }

                .message {
                    margin-bottom: 1.2rem;
                    padding: 0.9rem 1.2rem;
                    border-radius: 18px;
                    max-width: 78%;
                    word-wrap: break-word;
                    animation: fadeIn 0.4s ease;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                }

                /* Your own messages - right side */
                .message.sent {
                    background: linear-gradient(135deg, #6a4c93, #8b5fbf);
                    color: #ffffff;
                    margin-left: auto;
                    border-bottom-right-radius: 6px;
                }

                /* Others' messages - left side */
                .message.received {
                    background: rgba(40, 35, 70, 0.85);
                    color: #e6e0ff;
                    margin-right: auto;
                    border: 1px solid rgba(120, 100, 180, 0.3);
                    border-bottom-left-radius: 6px;
                }

                .sender-name {
                    font-weight: 600;
                    font-size: 0.88rem;
                    color: #b8a5ff;
                    margin-bottom: 0.4rem;
                }

                .message-time {
                    font-size: 0.75rem;
                    opacity: 0.7;
                    text-align: right;
                    margin-top: 0.4rem;
                    color: #ccc0ff;
                }

                .input-area {
                    background: rgba(20, 20, 40, 0.9);
                    padding: 1.2rem;
                    border-top: 1px solid rgba(100, 80, 150, 0.4);
                }

                .form-control, .form-control:focus {
                    background: rgba(40, 35, 70, 0.7);
                    border: 1px solid rgba(140, 120, 200, 0.4);
                    color: #e6e0ff;
                }

                .form-control::placeholder {
                    color: #9990c0;
                }

                .btn-primary {
                    background: linear-gradient(135deg, #8b5fbf, #6a4c93);
                    border: none;
                    box-shadow: 0 4px 15px rgba(139, 95, 191, 0.4);
                }

                .btn-primary:hover {
                    background: linear-gradient(135deg, #9d6dd3, #7a5bc7);
                    transform: translateY(-2px);
                }

                #connectionStatus {
                    position: fixed;
                    top: 1rem;
                    right: 1rem;
                    z-index: 1000;
                    background: rgba(0, 0, 0, 0.5);
                    backdrop-filter: blur(8px);
                    border: 1px solid rgba(100, 200, 100, 0.3);
                }

                .text-muted {
                    color: #a090d0 !important;
                }

                small {
                    color: #9988cc;
                }

                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(15px); }
                    to { opacity: 1; transform: translateY(0); }
                }

                /* Scrollbar styling (optional dark theme) */
                ::-webkit-scrollbar {
                    width: 8px;
                }
                ::-webkit-scrollbar-track {
                    background: rgba(0,0,0,0.3);
                }
                ::-webkit-scrollbar-thumb {
                    background: #6a4c93;
                    border-radius: 4px;
                }
    </style>
</head>
<body class="d-flex align-items-center">

<!-- Connection Status Badge -->
<div id="connectionStatus" class="badge bg-danger fs-6">
    <i class="fas fa-circle-notch fa-spin"></i> Connecting...
</div>

<div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
        <h3 class="mb-1"><i class="fas fa-comments me-2"></i>ChatRoom</h3>
        <p class="mb-0 opacity-75">Real-time messaging powered by WebSocket</p>
    </div>

    <!-- Messages Area -->
    <div id="chat" class="chat-messages">
        <div class="text-center text-muted fst-italic py-5">
            <i class="fas fa-comment-dots fa-3x mb-3 opacity-25"></i>
            <p>No messages yet. Start the conversation!</p>
        </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
        <div class="row g-2">
            <div class="col-md-4">
                <input id="senderInput" type="text" class="form-control" placeholder="Your name..." value="User">
            </div>
            <div class="col-md-8">
                <div class="input-group">
                    <input id="messageInput" type="text" class="form-control" placeholder="Type your message..." autocomplete="off">
                    <button id="sendMessage" class="btn btn-primary px-4" disabled>
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>
        <small class="text-muted d-block mt-2">
            Press <kbd>Enter</kbd> to send â€¢ Powered by Spring Boot + STOMP
        </small>
    </div>
</div>

<script>
    let stompClient = null;
    let currentUser = '';

    function updateConnectionStatus(connected) {
        const status = document.getElementById('connectionStatus');
        if (connected) {
            status.className = 'badge bg-success fs-6';
            status.innerHTML = '<i class="fas fa-wifi"></i> Connected';
            document.getElementById('sendMessage').disabled = false;
        } else {
            status.className = 'badge bg-danger fs-6';
            status.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Reconnecting...';
            document.getElementById('sendMessage').disabled = true;
        }
    }

    function connect() {
        const socket = new SockJS('/chat');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            updateConnectionStatus(true);
            console.log('Connected: ' + frame);

            stompClient.subscribe('/topic/messages', function (message) {
                const msg = JSON.parse(message.body);
                showMessage(msg);
            });
        }, function (error) {
            updateConnectionStatus(false);
            setTimeout(connect, 3000); // Auto-reconnect
        });
    }

    function showMessage(message) {
        const chat = document.getElementById('chat');
        const isOwnMessage = message.sender === currentUser;

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isOwnMessage ? 'sent' : 'received'} d-inline-block`;

        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

        messageDiv.innerHTML = `
            ${!isOwnMessage ? `<div class="sender-name">${escapeHtml(message.sender)}</div>` : ''}
            <div>${escapeHtml(message.content)}</div>
            <div class="message-time">${time}</div>
        `;

        // Clear "no messages" placeholder if exists
        if (chat.children[0] && chat.children[0].textContent.includes('No messages yet')) {
            chat.innerHTML = '';
        }

        chat.appendChild(messageDiv);
        chat.scrollTop = chat.scrollHeight;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function sendMessage() {
        const sender = document.getElementById('senderInput').value.trim();
        const content = document.getElementById('messageInput').value.trim();

        if (!sender || !content || !stompClient) return;

        currentUser = sender;

        const chatMessage = { sender: sender, content: content };
        stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
        document.getElementById('messageInput').value = '';
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function () {
        connect();

        document.getElementById('sendMessage').onclick = sendMessage;

        document.getElementById('messageInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Update current user when name changes
        document.getElementById('senderInput').addEventListener('change', function () {
            currentUser = this.value.trim() || 'Anonymous';
        });
    });
</script>
</body>
</html>